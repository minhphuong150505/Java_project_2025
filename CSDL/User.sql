-- 1. Tạo bảng ACCOUNT
CREATE TABLE ACCOUNT (
    ACCOUNT_ID    NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME      VARCHAR2(50) UNIQUE NOT NULL,
    FULL_NAME    VARCHAR2(100) NOT NULL,
    EMAIL        VARCHAR2(150) UNIQUE NOT NULL,
    SDT           VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD_HASH VARCHAR2(200) NOT NULL,
    STATUS        VARCHAR2(20) DEFAULT 'ACTIVE',
    CREATED_AT    DATE DEFAULT SYSDATE,
    UPDATED_AT    DATE DEFAULT SYSDATE,
    IS_DELETED    NUMBER(1) DEFAULT 0 CHECK (IS_DELETED IN (0,1))
);

SELECT * FROM ACCOUNT a

INSERT INTO ACCOUNT(USERNAME,PASSWORD_HASH,FULL_NAME,EMAIL,SDT) VALUES('nhu','a76b7f25b6ba5ec51bd9fa42f4143b63c2495996e783baa4d9f8459d314f6ad2','ád','123@gmail.com','0896980429');

-- 3. Tạo bảng ROLE
CREATE TABLE ROLE (
    ROLE_ID     NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ROLE_NAME VARCHAR2(50) NOT NULL,
    ADD_PERM    NUMBER(1) DEFAULT 0 CHECK (ADD_PERM IN (0,1)),
    EDIT_PERM   NUMBER(1) DEFAULT 0 CHECK (EDIT_PERM IN (0,1)),
    DELETE_PERM NUMBER(1) DEFAULT 0 CHECK (DELETE_PERM IN (0,1)),
    DOWNLOAD_PERM NUMBER(1) DEFAULT 0 CHECK (DOWNLOAD_PERM IN (0,1)),
    VIEW_PERM   NUMBER(1) DEFAULT 0 CHECK (VIEW_PERM IN (0,1)),
    CREATED_AT  DATE DEFAULT SYSDATE,
    UPDATED_AT  DATE DEFAULT SYSDATE,
    IS_DELETED  NUMBER(1) DEFAULT 0 CHECK (IS_DELETED IN (0,1))
);

SELECT * FROM ROLE


--4. Tạo bảng ACCOUNT_ROLE
CREATE TABLE ACCOUNT_ROLE (
    ACCOUNT_ID  NUMBER(10) NOT NULL,
    ROLE_ID     NUMBER(10) NOT NULL,
    CREATED_AT  DATE DEFAULT SYSDATE,
    UPDATED_AT  DATE DEFAULT SYSDATE,
    IS_DELETED  NUMBER(1) DEFAULT 0 CHECK (IS_DELETED IN (0,1)),
    CONSTRAINT FK_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID),
    CONSTRAINT FK_ROLE FOREIGN KEY (ROLE_ID) REFERENCES ROLE(ROLE_ID)
);

set
--Thêm ROLE
INSERT INTO ROLE(ROLE_NAME) VALUES ('ADMIN');
INSERT INTO ROLE(ROLE_NAME) VALUES ('USER');
-- Thêm Role
INSERT INTO ACCOUNT_ROLE (ACCOUNT_ID, ROLE_ID) VALUES (3, 1);
INSERT INTO ACCOUNT_ROLE (ACCOUNT_ID, ROLE_ID) VALUES (4, 2);
INSERT INTO ACCOUNT_ROLE (ACCOUNT_ID, ROLE_ID) VALUES (22, 1);
COMMIT
-- Thêm Group
INSERT INTO ACCOUNT_ROLE_GROUP (GROUP_NAME, DESCRIPTION) VALUES ('SYSTEM ADMIN', 'System management roles');
INSERT INTO ACCOUNT_ROLE_GROUP (GROUP_NAME, DESCRIPTION) VALUES ('GENERAL USER', 'General user roles');

-- Mapping Role - Group
INSERT INTO ACCOUNT_ROLE_GROUP_MAPPING (ACCOUNT_ROLE_ID, GROUP_ID) VALUES (1, 1);
INSERT INTO ACCOUNT_ROLE_GROUP_MAPPING (ACCOUNT_ROLE_ID, GROUP_ID) VALUES (2, 2);